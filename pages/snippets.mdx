---
type: page
title: Snippets
date: 2023-08-22
---

import { Tabs, Tab } from 'nextra/components'

## Access AppDelegate from SwiftUI App

```swift copy showLineNumbers
@main
struct IceCubesApp: App {
  @UIApplicationDelegateAdaptor private var appDelegate: AppDelegatern
}

class AppDelegate: NSObject, UIApplicationDelegate {
  func application(_: UIApplication,
                   didFinishLaunchingWithOptions _: [UIApplication.LaunchOptionsKey: Any]? = nil) -> Bool
  {
    print("Application did finish lauching")
  }
}
```

---

## Programmatic navigation with NavigationStack

```swift copy showLineNumbers
public enum RouterDestination: Hashable {
  case accountDetail(id: String)
}

@MainActor
extension View {
  func withAppRouter() -> some View {
    navigationDestination(for: RouterDestination.self) { destination in
      switch destination {
      case let .accountDetail(id):
        AccountDetailView(accountId: id)
      }
    }
  }
}

@MainActor
public class RouterPath: ObservableObject {
  @Published public var path: [RouterDestination] = []

  public func navigate(to: RouterDestination) {
    path.append(to)
  }
}


struct NotificationsTab: View {
  @StateObject private var routerPath = RouterPath()

  var body: some View {
    NavigationStack(path: $routerPath.path) {
        Button("Navigate to account") {
          routerPath.navigate(to: .accountDetail(id: accountId))
        }
        .withAppRouter()
    }
  }
}
```

[X Thread](https://twitter.com/Dimillian/status/1682037532895354880)

---

## Sheet with visual effect / blurred background and corner radius

```swift copy showLineNumbers
public struct AppAccountsSelectorView: View {
  @State private var isPresented: Bool = false

  public var body: some View {
    Button {
      isPresented.toggle()
    } label: {
      Text("Present sheet")
    }
    .sheet(isPresented: $isPresented, content: {
      accountsView
      .presentationDetents([.height(preferredHeight), .large])
      .presentationBackground(.thinMaterial)
      .presentationCornerRadius(16)
    })
  }
}
```

---

## Save array of Codable in @AppStorage

```swift copy showLineNumbers
extension Array: RawRepresentable where Element: Codable {
  public init?(rawValue: String) {
    guard let data = rawValue.data(using: .utf8),
          let result = try? JSONDecoder().decode([Element].self, from: data)
    else {
      return nil
    }
    self = result
  }

  public var rawValue: String {
    guard let data = try? JSONEncoder().encode(self),
          let result = String(data: data, encoding: .utf8)
    else {
      return "[]"
    }
    return result
  }
}
```

## Minimal SwiftUI + SwiftData app

<Tabs items={['Models', 'App', 'Views']}>
  <Tab>
  ```swift copy showLineNumbers
  @Model
  final class Thread {
    @Attribute(.unique) var id: UUID
    var createdOn: Date
    var content: String
    var author: User
    var isLiked: Bool = false

    init(content: String, author: User) {
      self.id = UUID()
      self.createdOn = Date()
      self.content = content
      self.author = author
    }
  }

  @Model
  final class User {
    @Attribute(.unique) var id: UUID
    var username: String

    init(username: String) {
      self.id = UUID()
      self.username = username
    }
  }

  ```
  </Tab>
  <Tab>
   ```swift copy showLineNumbers
  @main
  struct ThreadsApp: App {

    var body: some Scene {
      WindowGroup {
        TabView {
          TimelineView()
            .tabItem {
              Label("Home", systemImage: "house")
                .fontWeight(.medium)

            }
          ProfileView()
            .tabItem {
              Label("Profile", systemImage: "person")
                .fontWeight(.medium)
            }
        }
        .tint(.primary)
      }
      .modelContainer(for: Thread.self)
    }
  }
  ```
  </Tab>
  <Tab>
  <Tabs items={['TimelineView', 'ProfileView', 'ComposeView']}>
  <Tab>
  ```swift copy showLineNumbers
  struct TimelineView: View {
    @Environment(\.modelContext) private var modelContext
    @Query(sort: \Thread.createdOn, order: .reverse) private var threads: [Thread]

    @State private var isComposePresented: Bool = false

    var body: some View {
      NavigationStack {
        List(threads) { thread in
          ThreadRowView(thread: thread)
        }
        .listStyle(.plain)
        .navigationTitle("threadsApp")
        .navigationBarTitleDisplayMode(.inline)
        .toolbar {
          ToolbarItem(placement: .topBarTrailing) {
            Button {
              isComposePresented = true
            } label: {
              Image(systemName: "square.and.pencil")
            }
          }
        }
      }
      .sheet(isPresented: $isComposePresented, content: {
        ComposeView()
      })
      .onAppear {
        populateFakeDate()
      }
    }

    func populateFakeDate() {
      if threads.isEmpty {
        let user = User(username: "dimillian")
        let thread1 = Thread(content: "Helo world", author: user)
        modelContext.insert(thread1)
      }
    }
  }

  ```
  </Tab>
  <Tab>
   ```swift copy showLineNumbers
  struct ProfileView: View {
    enum Tab: Int, CaseIterable {
      case threads, liked

      var title: String {
        switch self {
        case .threads: return "Threads"
        case .liked: return "Liked"
        }
      }
    }

    @Query(sort: \Thread.createdOn, order: .reverse) private var myThreads: [Thread]
    @Query(filter: #Predicate { $0.isLiked },
          sort: \Thread.createdOn,
          order: .reverse) private var likedTreads: [Thread]

    @State private var selectedTab: Tab = .threads

    var body: some View {
      NavigationStack {
        VStack {
          headerView
            .padding()
          buttonsView
            .padding(.horizontal)
          TabView(selection: $selectedTab) {
            ThreadsListView(threads: myThreads)
              .tag(Tab.threads)
            ThreadsListView(threads: likedTreads)
              .tag(Tab.liked)
          }
          .tabViewStyle(.page)
        }
        .navigationTitle("Profile")
        .navigationBarTitleDisplayMode(.inline)
      }
    }

    private var buttonsView: some View {
      HStack {
        ForEach(Tab.allCases, id: \.self) { tab in
          if tab == selectedTab {
            Button { selectedTab = tab } label: { Text(tab.title) }
            .buttonStyle(.borderedProminent)
          } else {
            Button { selectedTab = tab } label: { Text(tab.title) }
            .buttonStyle(.bordered)
          }
        }
        Spacer()
      }
    }

    private var headerView: some View {
      HStack(alignment: .top) {
        VStack(alignment: .leading, spacing: 8) {
          Text("Thomas Ricouard")
            .font(.headline)
            .fontWeight(.heavy)
          Text("dimillian")
            .font(.body)
        }
        Spacer()
        AvatarView()
      }
    }
  }
  ```
  </Tab>
  <Tab>
  ```swift copy showLineNumbers
  struct ComposeView: View {
    enum FocusField: Hashable {
      case threadContent
    }

    @Environment(\.dismiss) private var dismiss
    @Environment(\.modelContext) private var modelContext

    @State private var threadContent = ""
    @FocusState private var focusedField: FocusField?

    var body: some View {
      NavigationStack {
        Divider()
        ZStack(alignment: .bottom) {
          VStack {
            HStack(alignment: .top, spacing: 6) {
              AvatarView()
              VStack(alignment: .leading, spacing: 4) {
                TextField("Start a thread", text: $threadContent, axis: .vertical)
                  .focused($focusedField, equals: .threadContent)
                  .onAppear {
                    focusedField = .threadContent
                  }
              }
            }
            .padding()
            Spacer()
          }
          HStack {
            Spacer()
            Button {
              let user = User(username: "dimillian")
              let thread1 = Thread(content: threadContent, author: user)
              modelContext.insert(thread1)
              dismiss()
            } label: {
              Text("Post")
            }
          }
          .padding()
        }
        .navigationTitle("New thread")
        .navigationBarTitleDisplayMode(.inline)
        .toolbar {
          ToolbarItem(placement: .topBarLeading) {
            Button {
              dismiss()
            } label: {
              Text("Cancel")
            }
          }
        }
      }
    }
  }
  ```
  </Tab>
  </Tabs>
  </Tab>
</Tabs>

## Creating and using custom Environment values in SwiftUI

```swift copy showLineNumbers
public extension EnvironmentValues {
  var isSecondaryColumn: Bool {
    get { self[SecondaryColumnKey.self] }
    set { self[SecondaryColumnKey.self] = newValue }
  }
}

public struct NotificationsTab: View {
  public var body: some View {
     NotificationsListView()
      .environment(\.isSecondaryColumn, true)
  }
}

public struct NotificationsListView: View {
  @Environment(\.isSecondaryColumn) private var isSecondaryColumn: Bool

  public var body: some View {
    if isSecondaryColumn {
      Text("I'm secondary column")
    } else {
      Text("I'm not secondary column")
    }
  }
}
```
